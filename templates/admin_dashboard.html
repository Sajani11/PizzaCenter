{% extends 'layout.html' %} {% block title %}Admin Dashboard{% endblock %} {%
block content %}

<div class="container mt-5">
  <h2 class="text-center mb-4">Admin Dashboard</h2>

  <!-- Flash messages -->
  {% with messages = get_flashed_messages() %} {% if messages %} {% for message
  in messages %}
  <div class="alert alert-info alert-dismissible fade show" role="alert">
    {{ message }}
    <button
      type="button"
      class="btn-close"
      data-bs-dismiss="alert"
      aria-label="Close"
    ></button>
  </div>
  {% endfor %} {% endif %} {% endwith %}

  <!-- Orders Section -->
  <div class="card mb-5 shadow rounded">
    <div class="card-header bg-primary text-white">Manage Orders</div>
    <div class="card-body table-responsive">
      <table class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Order ID</th>
            <th>User</th>
            <th>Pizza</th>
            <th>Price</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for order in orders %}
          <tr>
            <td>{{ order.id }}</td>
            <td>{{ order.username }}</td>
            <td>{{ order.pizza_name }}</td>
            <td>Rs {{ order.price }}</td>
            <td>{{ order.status }}</td>
            <td>
              {% if order.status == 'pending' %}
              <a
                href="{{ url_for('mark_as_completed', order_id=order.id) }}"
                class="btn btn-success btn-sm"
              >
                Mark as Completed
              </a>
              {% else %}
              <button class="btn btn-secondary btn-sm" disabled>
                Completed
              </button>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Pizzas Section -->
  <div class="card mb-5 shadow rounded">
    <div class="card-header bg-warning text-dark">Manage Pizzas</div>
    <div class="card-body">
      <form
        method="POST"
        action="{{ url_for('add_pizza') }}"
        enctype="multipart/form-data"
        class="row g-3 mb-4"
      >
        <div class="col-md-4">
          <input
            type="text"
            name="name"
            class="form-control"
            placeholder="Pizza Name"
            required
          />
        </div>
        <div class="col-md-4">
          <input
            type="text"
            name="description"
            class="form-control"
            placeholder="Description"
            required
          />
        </div>
        <div class="col-md-2">
          <input
            type="number"
            step="0.01"
            name="price"
            class="form-control"
            placeholder="Price"
            required
          />
        </div>
        <div class="col-md-2">
          <input type="file" name="image" class="form-control" />
        </div>
        <div class="col-md-12 text-end">
          <button type="submit" class="btn btn-warning">Add Pizza</button>
        </div>
      </form>

      <div class="row">
        {% for pizza in pizzas %}
        <div class="col-md-4 mb-4">
          <div class="card h-100 shadow-sm">
            <img
              src="{{ pizza.image }}"
              class="card-img-top"
              style="height: 200px; object-fit: cover"
              alt="{{ pizza.name }}"
            />
            <div class="card-body">
              <h5 class="card-title">{{ pizza.name }}</h5>
              <p class="card-text">{{ pizza.description }}</p>
              <p class="fw-bold">Rs {{ pizza.price }}</p>
              <a
                href="{{ url_for('delete_pizza', pizza_id=pizza.id) }}"
                class="btn btn-danger btn-sm"
                >Delete</a
              >
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
